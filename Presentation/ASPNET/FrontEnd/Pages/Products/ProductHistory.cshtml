@page
@{
    ViewData["Title"] = "Product History";
}

<style>
    /* --- Audit Timeline Styles --- */
    .audit-timeline {
        position: relative;
        padding-left: 30px;
    }

        .audit-timeline::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #d0d7de;
        }

    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }

    .timeline-icon {
        position: absolute;
        left: -20px;
        width: 14px;
        height: 14px;
        background: #0d6efd;
        border-radius: 50%;
        top: 5px;
    }

    .timeline-content {
        background: #f8f9fa;
        padding: 10px 15px;
        border-radius: 4px;
    }
</style>

<div id="app" v-cloak>
    <!-- SEARCH BAR (TOP) -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <strong>Search Attribute</strong>
                </div>
                <div class="card-body">
                    <input type="text"
                           class="form-control"
                           placeholder="Enter IMEI / Service No"
                           v-model="state.searchAttribute" />

                    <div class="mt-3 text-end">
                        <button class="btn btn-primary"
                                :disabled="state.isSearching"
                                @@click ="handler.handleSearch">
                            <span v-if="!state.isSearching">Search</span>
                            <span v-else class="spinner-border spinner-border-sm"></span>
                        </button>
                    </div>

                    <small class="text-danger" v-if="state.searchError">
                        {{ state.searchError }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- RESULT PANELS -->
    <div class="row" v-if="state.resolvedAttributeType">
        <!-- LEFT PANEL -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <strong>Product Attributes</strong>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <label class="fw-bold">Resolved Type</label>
                        <div>{{ state.resolvedAttributeType }}</div>
                    </div>

                    <div class="mb-2">
                        <label>IMEI 1</label>
                        <input class="form-control"
                               v-model="state.resolvedAttributes.imei1"
                               readonly />

                    </div>

                    <div class="mb-2">
                        <label>IMEI 2</label>
                        <input class="form-control"
                               v-model="state.resolvedAttributes.imei2"
                               readonly />

                    </div>

                    <div class="mb-2">
                        <label>Service No</label>
                        <input class="form-control" disabled
                               :value="state.resolvedAttributes.serviceNo" />
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <strong>Audit Trail</strong>
                </div>
                <div class="card-body audit-timeline">
                    <div v-for="(item, index) in state.transactionHistory"
                         :key="index"
                         class="timeline-item">

                        <div class="timeline-icon"></div>

                        <div class="timeline-content">
                            <strong>
                                {{ item.moduleName }}
                                <span class="badge bg-secondary ms-2">{{ item.movementDirection }}</span>
                            </strong>

                            <div class="text-muted">
                                {{ item.moduleCode }} •
                                {{ new Date(item.movementDate).toLocaleString() }}
                            </div>

                            <div class="mt-2">
                                <div> Warehouse: {{ item.warehouseName }}</div>

                                <div v-if="item.warehouseFromName || item.warehouseToName">
                                    From → To:
                                    {{ item.warehouseFromName || '—' }}
                                    →
                                    {{ item.warehouseToName || '—' }}
                                </div>

@*                                 <div> User: {{ item.CreatedUserId || 'System' }}</div>
 *@                            </div>

                            <hr class="my-2" />

                            <div>
                                Movement:
                                <span :class="item.movementDirection === 'IN' ? 'text-success fw-bold' :
                  item.movementDirection === 'OUT' ? 'text-danger fw-bold' : ''">
                                    {{ item.movement }}
                                </span>
                            </div>

                            <div>
                                Stock : {{ item.stock }}
                            </div>
                            @* <div class="text-muted">
                                {{ item.moduleCode }} •
                                {{ new Date(item.movementDate).toLocaleString() }}
                            </div>

                            <div class="mt-1">
                                Movement: {{ item.movement }}
                            </div>
                            <div>
                                Stock: {{ item.stock }}
                            </div> *@
                        </div>
                    </div>

                    <div v-if="state.transactionHistory.length === 0"
                         class="text-muted">
                        No transaction history found
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/FrontEnd/Pages/Products/ProductHistory.cshtml.js"></script>
}
