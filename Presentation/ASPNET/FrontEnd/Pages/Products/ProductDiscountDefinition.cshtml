@page
@{
    ViewData["Title"] = "Product Discount Definition";
}

<div id="app" v-cloak>
    <div class="row">
        <div class="col-12">
            <div class="grid-container">
                <div ref="mainGridRef"></div>
            </div>
        </div>
    </div>

    <div class="modal fade" ref="mainModalRef" id="MainModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ state.mainTitle }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <input type="hidden" v-model="state.id" />
                    <form id="MainForm">
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">General Configuration</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Product</label>
                                        <div ref="productIdRef"></div>
                                        <span class="text-danger small">{{ state.errors.productId }}</span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Discount Name</label>
                                        <input v-model="state.discountName" class="form-control" placeholder="Eg: Seasonal Sale" />
                                        <span class="text-danger small">{{ state.errors.discountName }}</span>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Discount Type</label>
                                        <div ref="discountTypeRef"></div>
                                        <span class="text-danger small">{{ state.errors.discountType }}</span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Status</label>
                                        <div ref="statusRef"></div>
                                    </div>
                                </div>

                                <hr />

                                <div class="row mb-3" v-if="state.discountType === 'Flat'">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Flat Discount Percentage (%)</label>
                                        <input v-model="state.discountPercentage" type="number" class="form-control" placeholder="0.00" />
                                        <span class="text-danger small">{{ state.errors.discountPercentage }}</span>
                                    </div>
                                </div>

                                <div v-if="state.discountType === 'Upto'" class="mt-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="text-primary mb-0 font-weight-bold">User Group Limits</h6>
                                        <button type="button" class="btn btn-sm btn-primary" @@click="detailMethods.addDetailRow">+ Add Group Row</button>
                                    </div>
                                    <div class="table-responsive border rounded bg-light p-2">
                                        <table class="table table-sm table-bordered bg-white mb-0">
                                            <thead>
                                                <tr>
                                                    <th>User Group Selection</th>
                                                    <th style="width: 180px;">Max % Allowed</th>
                                                    <th style="width: 50px;"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr v-for="(detail, index) in state.discountDetails" :key="index">
                                                    <td>
                                                        <select v-model="detail.userGroupId" class="form-select">
                                                            <option :value="null">-- Select Group --</option>
                                                            <option v-for="ug in detailMethods.getAvailableUserGroups(index)" :key="ug.id" :value="ug.id">
                                                                {{ ug.name }}
                                                            </option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input v-model="detail.maxPercentage" type="number" class="form-control" placeholder="0" />
                                                    </td>
                                                    <td class="text-center">
                                                        <button type="button" class="btn btn-outline-danger btn-sm" @@click="detailMethods.removeDetailRow(index)">
                                                            Remove
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <span class="text-danger small">{{ state.errors.details }}</span>
                                </div>

                                <hr />

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Effective From</label>
                                        <input v-model="state.effectiveFrom" type="date" class="form-control" />
                                        <span class="text-danger small">{{ state.errors.effectiveFrom }}</span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Effective To</label>
                                        <input v-model="state.effectiveTo" type="date" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="modal-footer bg-light">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary" :disabled="state.isSubmitting" @@click="handler.handleSubmit">
                        <span v-if="state.isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                        Save Discount
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/FrontEnd/Pages/Products/ProductDiscountDefinition.cshtml.js"></script>
}